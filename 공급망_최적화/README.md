# 판매 예측 기반 재고·발주 시뮬레이션 (DataCo)

    - 목표: 판매량을 예측하고, 그 값을 사용해 언제·얼마나 주문할지 계산하여 배송 약속 준수(충족률)를 높이고 불필요한 재고를 줄이는 방법을 보여줌.
    - 데이터: Kaggle – DataCo SMART SUPPLY CHAIN FOR BIG DATA ANALYSIS

## 🔍 무엇을 했나 (한눈 요약)

- 데이터 정리: 주간 기준 통일(일요일 기준), 마지막 부분 주 제외, 말미 급락 구간 자동 제외
- 판매 예측: Prophet으로 4~8주 앞 예측, 테스트 구간에서 오차(예: MAPE, sMAPE) 확인
- 발주 시뮬레이션: 예측값으로 발주 시점·수량을 계산(S–ROP 정책)
- 결과 예시
        충족률(Fill rate): 99.23%
        발주 횟수: 104회 / 총 발주량: 400,167
        (가정) 리드타임 2주, 안전 재고 2,270, 재주문 기준 5,572, 목표 재고(S) 7,223

## 데이터셋

주요 컬럼(이름은 프로젝트 코드에 맞게 매핑):
    order_date(주문일), order_qty(수량), 
    lt_real_days(실제 소요일), lt_sched_days(계획 소요일)
    otd_flag(약속일 준수 여부), late_flag(지연 여부)
    order_country(국가), order_id(주문 ID)

## 분석 흐름(파이프라인)

    1. 데이터 정리
        - 날짜/수량 형 변환, 결측 제거
        - 주간 기준 통일: 일요일 기준으로 한 주를 묶어 라벨(날짜)을 맞춤
        - 부분 주 제거: 마지막 주가 7일 꽉 차지 않으면 제외
        - 말미 급락 구간 자동 제외: 기준치의 35% 이하가 6주 연속이면 그 전까지만 사용
            → 정상 구간만 학습/평가/시뮬에 사용

    2. 탐색(EDA)
        - 월별 평균 소요일 ↔ 배송 약속 준수율(이중축) + 월별 주문 수
        -소요일 분포(히스토그램, p50/p90/p95)
        - 국가별 지연 파레토(상위 몇 개 국가가 몇 %를 차지하는지)

    3. 판매 예측
        - Prophet(주간·연간 패턴), Horizon 4~8주
        - 홀드아웃(마지막 12주)으로 오차 지표(MAPE/sMAPE/RMSE/MAE) 확인
        - 그래프: 실제 vs 예측(테스트)

    4. 발주 시뮬레이션
        - 정책: S–ROP
                - 재주문 기준(ROP) = 리드타임 동안의 수요 + 안전 재고
                - 목표 재고(S) = ROP + 1주분(예)
        - 리드타임 2주(예), 안전 재고는 최근 변동성으로 근사(z·σ·√LT)
        - 결과 KPI: 충족률, 발주 횟수, 총 발주량
        - 그래프: 재고 곡선(톱니), 발주/입고 이벤트, 요청 vs 출고(미출고 음영)

    5. 점검/해석
        - implied_avg = (ROP - 안전재고)/리드타임 과 최근 평균/중앙값 비교 → 평균 추정 과소/과대 여부 확인
        - 동적 ROP(다음 리드타임 기간 예측합 + 안전재고) 비교 가능


## 결과(임의 날짜 지정해서 테스트)

    - 월간 현황
            배송 약속 준수율: 41~45% 범위
            평균 소요일: 약 3.5일 (상위 5%는 6일 이상)
            
    - 지연 집중도(국가)
            상위 약 10개 국가가 지연의 80% 차지 → 개선 우선순위 명확
            
    - 판매 예측(테스트 12주)
            오차 예시: MAPE {x%}, sMAPE {y%}, RMSE/MAE
            그래프: 실제 vs 예측(테스트)
            
    - 발주 시뮬레이션
            충족률: 99.23%
            발주: 104회, 총 발주량: 400,167
            가정: 리드타임 2주, 안전 재고 2,270, 재주문 기준 5,572, 목표 재고 7,223

### +) 📌 설계 선택의 이유 (짧게)

    - 주간 기준 통일(일요일): 예측 결과의 주간 라벨과 정확히 맞추기 위함
    - 부분 주/급락 구간 제외: 불완전한 구간은 학습·평가·의사결정에 혼선을 줌
    - 홀드아웃 평가: “얼마나 맞췄는지”를 수치로 확인해야 발주에 쓸 수 있음
    - S–ROP 정책: 단순하면서도 운영에 바로 적용 가능한 방식

### +) 📚 용어(짧게)

배송 약속 준수율(OTD): 약속한 날짜에 맞춰 보낸 비율
소요일(Lead time): 주문~출하까지 걸린 날
충족률(Fill rate): 요청량 중 실제로 처리한 비율
안전 재고(Safety stock): 변동성 대비 여유분
재주문 기준(ROP): 이 수준 이하면 다시 주문
목표 재고(S): 보충 목표 수준
